<div class="profile-header" style="display:flex; gap:16px; align-items:center; flex-wrap:wrap;">
  <div class="avatar large" style="overflow:hidden;">
    {% if current_user.avatar_path %}
      <img src="{{ url_for('profile_avatar') }}" alt="avatar" style="display:block; width:100%; height:100%; object-fit:cover; border-radius:50%;">
    {% else %}
      <span>{{ (current_user.full_name or current_user.username or current_user.email)[:1]|upper }}</span>
    {% endif %}
  </div>
  <div>
    <div class="value" style="font-size:18px;">{{ current_user.full_name or _('—') }}</div>
    <div class="muted">
      {% set email = current_user.email or '' %}
      {% set parts = email.split('@') %}
      {% if parts|length == 2 %}
        {{ parts[0][:2] ~ '***@' ~ parts[1] }}
      {% else %}
        {{ email }}
      {% endif %}
    </div>
    {# Скрыт статус подписки #}
    {#
    {% set _sub = sub if sub is defined else (last_sub if last_sub is defined else (current_user.subscriptions.order_by(models.Subscription.created_at.desc()).first() if current_user.is_authenticated else None)) %}
    {% if _sub and _sub.status %}
      <div style="margin-top:6px;">
        <span class="chip status-{{ _sub.status }}">{{ _sub.status }}</span>
        {% if _sub.current_period_end %}
          <span class="muted">{{ _('до') }} {{ _sub.current_period_end.strftime('%d.%m.%Y') }}</span>
        {% endif %}
      </div>
    {% endif %}
    #}
  </div>
</div>
