<!doctype html>
<html lang="{{ session.get('lang', 'ru') }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}Wiru Combat Academy {% endblock %}</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Anton&family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">


  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <meta name="csrf-token" content="{{ csrf_token() }}">
  <script defer src="{{ url_for('static', filename='js/main.js') }}"></script>
  <script>
    // Global fetch wrapper to attach CSRF token to non-GET requests
    (function(){
      try{
        var tag = document.querySelector('meta[name="csrf-token"]');
        var token = tag ? tag.getAttribute('content') : null;
        if(!token) return;
        var originalFetch = window.fetch;
        window.fetch = function(input, init){
          init = init || {};
          var method = (init.method || 'GET').toUpperCase();
          if (method !== 'GET' && method !== 'HEAD' && method !== 'OPTIONS'){
            var hdrs = init.headers || {};
            try{
              // If Headers object, clone to set new header
              if (typeof Headers !== 'undefined' && hdrs instanceof Headers){
                var h2 = new Headers(hdrs);
                if (!h2.has('X-CSRFToken')) h2.set('X-CSRFToken', token);
                init.headers = h2;
              } else {
                if (!('X-CSRFToken' in hdrs)) hdrs['X-CSRFToken'] = token;
                init.headers = hdrs;
              }
            }catch(e){ /* noop */ }
          }
          return originalFetch(input, init);
        };
      }catch(e){ /* noop */ }
    })();
  </script>
  {% block extra_css %}{% endblock %}
  <style>
    /* Mobile-only override: slightly narrower side drawer */
    @media (max-width: 640px) {
      #nav.nav { width: 72vw; max-width: 280px; }
      /* hide auth/login button on mobile */
      .header-actions .btn { display: none !important; }
    }
    /* Overlay default: hidden; enable only when menu is open */
    .nav-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      -webkit-backdrop-filter: saturate(120%) blur(1px);
      backdrop-filter: saturate(120%) blur(1px);
      opacity: 0;
      pointer-events: none;
      transition: opacity .3s ease;
      z-index: 150;
    }
    body.menu-open .nav-overlay {
      opacity: 1;
      pointer-events: auto;
    }
    /* improve spacing in right header area */
    .header-actions { gap: 16px; }
    .auth-ctrls { display:flex; align-items:center; gap: 14px; }
    .lang-switch { margin-right: 6px; }
    /* header user avatar */
    .header-actions .user-avatar {
      width: 36px; height: 36px;
      display: inline-flex; align-items: center; justify-content: center;
      color: #ddd; background: #1a1a1a; border: 1px solid #333; border-radius: 50%;
      transition: border-color .2s ease, color .2s ease, background .2s ease;
      vertical-align: middle;
    }
    .header-actions .user-avatar:hover { border-color: var(--accent); color: #fff; background: #222; }
    @media (min-width: 641px){
      .header-actions{ justify-self: end; }
      .header .nav{ justify-self: center; }
    }
  </style>
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='images/favicon/apple-touch-icon.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/favicon/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='images/favicon/favicon-16x16.png') }}">
    <link rel="manifest" href="{{ url_for('static', filename='images/favicon/site.webmanifest') }}">
    <meta name="theme-color" content="#000000">
    
    <!-- Dynamic SEO -->
    <title>{{ title or "Wiru Combat Academy" }}</title>
    <meta name="description" content="{{ description or 'Тренировки по боксу и ММА в Кохтла-Ярве для детей и взрослых' }}">
    <meta name="keywords" content="бокс Кохтла-Ярве, мма Кохтла-Ярве, спорт Кохтла-Ярве, тренировки, wiru combat academy">
    <meta name="author" content="Wiru Combat Academy">
    
    <!-- Open Graph -->
    <meta property="og:title" content="{{ og_title or 'Wiru Combat Academy — Академия Единоборств в Кохтла-Ярве' }}">
    <meta property="og:description" content="{{ og_desc or 'Тренировки по боксу и ММА для всех возрастов' }}">
    <meta property="og:image" content="{{ url_for('static', filename='images/og-image.jpg', _external=True) }}">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:type" content="website">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ og_title or 'Wiru Combat Academy' }}">
    <meta name="twitter:description" content="{{ og_desc or 'Спортивная академия единоборств в Кохтла-Ярве' }}">
    <meta name="twitter:image" content="{{ url_for('static', filename='images/og-image.jpg', _external=True) }}">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{{ request.url }}">
</head>
<body>
<header class="header">
  <div class="container header-inner">
    <!-- Лого -->
    <div class="logo">
      <a href="{{ url_for('home') }}">
        <img src="{{ url_for('static', filename='images/logo_header.png') }}" alt="Wiru Combat Academy Logo">
      </a>
    </div>

    <nav id="nav" class="nav">
      <div class="nav-header">
        <a class="nav-logo" href="{{ url_for('home') }}">
          <img src="{{ url_for('static', filename='images/logo_header.png') }}" alt="Wiru Combat Academy Logo">
        </a>
      </div>
      <a href="{{ url_for('home') }}">{{ _('Главная') }}</a>
      <a href="{{ url_for('news_list') }}" style="display:none" aria-hidden="true" tabindex="-1">{{ _('Новости') }}</a>
      <a href="{{ url_for('schedule_page') }}">{{ _('Расписание') }}</a>
      <a href="{{ url_for('trainers_page') }}">{{ _('Тренеры') }}</a>
      <a href="{{ url_for('contact') }}">{{ _('Контакты') }}</a>
                </nav>
        <div class="header-actions">
      <div class="lang-switch">
        {% for code in LANGUAGES %}
          <a class="lang {{ 'active' if session.get('lang','ru')==code else '' }}" href="{{ request.path }}?lang={{ code }}">{{ code.upper() }}</a>
        {% endfor %}
      </div>
      <div class="auth-ctrls">
        {% if not current_user.is_authenticated %}
          <a class="btn" href="{{ url_for('login') }}" style="display:none" aria-hidden="true" tabindex="-1">{{ _('Войти') }}</a>
        {% else %}
          <a href="{{ url_for('profile') }}" class="user-avatar" title="{{ _('Профиль') }}" aria-label="{{ _('Профиль') }}">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M20 21a8 8 0 0 0-16 0"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          </a>
          <a href="{{ url_for('logout') }}">{{ _('Выход') }}</a>
        {% endif %}
      </div>
      <button class="burger" aria-label="Menu" onclick="toggleMenu()">☰</button>
    </div>
  </div>
</header>

<main class="main">
  {% with messages = get_flashed_messages(with_categories=True) %}
    {% if messages %}
    <div class="flash" id="flash">
      {% for cat, m in messages %}
        <div class="flash-item {{ cat|default('message') }}">{{ m }}</div>
      {% endfor %}
    </div>
    <script>
      // Auto-hide flash messages after 1 second with a smooth transition
      (function(){
        var container = document.getElementById('flash');
        if (!container) return;
        setTimeout(function(){
          var items = container.querySelectorAll('.flash-item');
          items.forEach(function(el){ el.classList.add('hide'); });
          setTimeout(function(){
            if (container && container.parentNode) container.parentNode.removeChild(container);
          }, 300);
        }, 1000);
      })();
    </script>
    {% endif %}
  {% endwith %}
  {% block content %}{% endblock %}
</main>
<footer class="footer">
  <div class="footer-container">
    <!-- Форма + Логотип -->
    <div class="footer-top">
      <div class="footer-form">
        <h3>{{ _('Напишите нам') }}</h3>
<form method="POST" action="{{ url_for('send_message') }}">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  
  <div class="form-row two-cols">
    <input type="text" name="name" placeholder="{{ _('Ваше имя') }}" required>
    <input type="email" name="email" placeholder="{{ _('Ваш Email') }}" required>
  </div>
  <textarea name="message" placeholder="{{ _('Ваше сообщение') }}" rows="5" required></textarea>
  <button type="submit">{{ _('Отправить') }}</button>
</form>

      </div>

      <!-- Логотип справа -->
      <div class="footer-logo">
        <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Wiru Combat Academy Logo">
      </div>
    </div>

    <!-- Карта + контакты -->
    <div class="footer-bottom">
      <div class="footer-map">
        <div style="width:100%; height:400px;">
  <iframe
    src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d1925.701057225439!2d27.275484534636032!3d59.397257499382036!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x469471e0e775ef25%3A0xb0da126ff4f8ee0f!2sWiru%20Spordikeskus!5e0!3m2!1sru!2sus!4v1758046051065!5m2!1sru!2sus"
    width="100%"
    height="100%"
    style="border:0; border-radius:8px;"
    allowfullscreen=""
    loading="lazy"
    referrerpolicy="no-referrer-when-downgrade">
  </iframe>
</div>

      </div>

      <div class="footer-contacts">
        <h3>{{ _('Контакты') }}</h3>
        <p>Järveküla tee 41, Järve, 30321 <br>Ida-Viru maakond</p>
        <p><a href="tel:+37256870131">+3725687 0131</a></p>
        <p><a href="mailto:wirucombatacademy@gmail.com">wirucombatacademy@gmail.com</a></p>
        <h3>{{ _('Банк') }}</h3>
        <p>MTÜ Wiru Combat Academy</p>
        <p>EE974204278639060207</p>
        <div class="socials">
          <a href="https://www.facebook.com/p/Wiru-Combat-Academy-61575157714278/" target="_blank" rel="noopener noreferrer">Facebook</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Нижняя строка -->
  <div class="footer-copy">
    <p>
      &copy; {{ now.year }} Wiru Combat Academy — {{ _('Все права защищены') }}
      | <a href="{{ url_for('privacy') }}">Privaatsuspoliitika</a>
      | <a href="{{ url_for('terms') }}">Kasutustingimused</a>
      | <a href="{{ url_for('cookies') }}">Küpsiste poliitika</a>
      | <a href="{{ url_for('youth') }}">Noorte ja lapsevanemate tingimused</a>
      | <a href="{{ url_for('marketing') }}">Turundusnõusolek</a>
    </p>
  </div>
</footer>


<script src="{{ url_for('static', filename='js/title-line.js') }}"></script>
</body>
</html>
